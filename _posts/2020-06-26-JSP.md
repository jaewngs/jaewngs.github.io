---



title:  "JSP 페이지 연동"



layout: post



---


## [오늘 할 내용]
1. JSP 페이지 연동을 구현하는 방법
2. JSP page 지시어와 속성을 구현할 수 있다.
3. 페이지 제어권을 선언하고 활용할 수 있다.
4. JSP 내장 객체를 이해할 수 있다.
5. 전역 DB를 WAS에 등록해서 호출 할 수 있다.


***

### JSP 페이지 연동
- WAS가 엔진을 통해서 .class 변환 후 서비스 메소드를 통해 출력된다.
![image](https://user-images.githubusercontent.com/52989294/85810215-4f7fb100-b795-11ea-91e8-50c6d2c2b492.png)


- Webcontent/META-INF/context.xml 파일에서 WAS의 JSP 엔진 작업경로 지정 가능
	- context.xml 파일은 Servers/context.xml에서 복사해온다.
	- <**Context workDir = "경로지정"**> 속성을 이용해서 WAS의 JSP 엔진 작업경로를 변경 할 수 있다.

    ~~~ xml
    <?xml version="1.0" encoding="UTF-8"?>
    <!-- Licensed to the Apache Software Foundation (ASF) under one or more contributor
        license agreements. See the NOTICE file distributed with this work for additional
        information regarding copyright ownership. The ASF licenses this file to
        You under the Apache License, Version 2.0 (the "License"); you may not use
        this file except in compliance with the License. You may obtain a copy of
        the License at http://www.apache.org/licenses/LICENSE-2.0 Unless required
        by applicable law or agreed to in writing, software distributed under the
        License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS
        OF ANY KIND, either express or implied. See the License for the specific
        language governing permissions and limitations under the License. --><!-- The contents of this file will be loaded for each web application -->
    <Context workDir="C:\webwork\Day52\WebContent\myjsp\classes">

        <!-- Default set of monitored resources. If one of these changes, the -->
        <!-- web application will be reloaded. -->
        <WatchedResource>WEB-INF/web.xml</WatchedResource>
        <WatchedResource>${catalina.base}/conf/web.xml</WatchedResource>

        <!-- Uncomment this to disable session persistence across Tomcat restarts -->
        <!-- <Manager pathname="" /> -->

    <!-- DB연동 -->
        <Resource name="jdbc/myoracle" auth="Container"
            type="javax.sql.DataSource" driverClassName="oracle.jdbc.OracleDriver"
            url="jdbc:oracle:thin:@127.0.0.1:1521:xe" username="big5"
            password="admin1234" maxTotal="20" maxIdle="10" maxWaitMillis="-1" />
    </Context>
    ~~~

- WebContent/WEB-INF/web.xml 수정
    ~~~ xml
    <?xml version="1.0" encoding="UTF-8"?>
    <web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="http://xmlns.jcp.org/xml/ns/javaee"
        xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"
        id="WebApp_ID" version="3.1">
        <display-name>Day52</display-name>
        <welcome-file-list>
            <welcome-file>index.jsp</welcome-file>
        </welcome-file-list>
    </web-app>
    ~~~

- WebContent/index.jsp 생성

    ~~~ jsp
    <%@ page language="java" contentType="text/html; charset=EUC-KR"
        pageEncoding="EUC-KR"%>
    <!DOCTYPE html>
    <html>
    <head>
    <meta charset="EUC-KR">
    <title>Insert title here</title>
    </head>
    <body>
        <h1>index.jsp</h1>
        <%=application.getRealPath(".")%>
        <!-- out.print(application.getRealPath(".")); 과 동일 -->
    </body>
    </html>
    ~~~

***

### JSP page 지시어와 속성
- 스크립트
	~~~ jsp
	- <!      > : 전역변수 전역메소드 선언 부분
	- <%   %> : java 코드
	- <%=   > : 출력문 -> JspWriter.print()
	~~~

- 주석
	~~~ jsp
    <!-- html 주석 -->  --> 공개
    <%   // java 주석   %>  --> 비공개
    <%--   jsp 주석   --%> --> 비공개
    ~~~

***

### 페이지 제어권을 선언하고 활용하기
- forward( ) : 제어권을 대상 페이지에 넘긴다.
- include( ) : 제어권을 대상 path로부터 가져온다.
- WebContent/test02/ jsp파일 ㄲ



***

### JSP 내장 객체
- final javax.servlet.jsp.PageContext pageContext;
- javax.servlet.http.HttpSession session = null;
- final javax.servlet.ServletContext application;
- final javax.servlet.ServletConfig config;
- javax.servlet.jsp.JspWriter out = null;
- final java.lang.Object page = this;
- javax.servlet.jsp.JspWriter _jspx_out = null;
- javax.servlet.jsp.PageContext _jspx_page_context = null;

***

### 전역 DB를 WAS에 등록해서 호출하자
- server.xml에 붙이는 방법
- context.xml에 붙이는 방법
- /WEB-INF/lib/플러그인, jar, lib 등을 붙인다.

- WebContent/test04/a.jsp
	- DB 테이블 값 불러와보기

    ~~~ jsp
    <%@ page language="java" contentType="text/html; charset=EUC-KR"
        pageEncoding="EUC-KR"%>
    <%@ page import="java.sql.*, java.util.*"%>

    <!DOCTYPE html>
    <html>
    <head>
    <meta charset="EUC-KR">
    <title>Insert title here</title>
    </head>
    <body>
        <%
        Class.forName("oracle.jdbc.OracleDriver");
        String url = "jdbc:oracle:thin:@localhost:1521:XE";
        String id = "big5";
        String pwd = "admin1234";

        Connection conn = DriverManager.getConnection(url, id, pwd);
        if (!conn.isClosed()) {
            out.println("데이터 베이스 연결 성공했습니다.<br>");
        }

        Statement stmt = conn.createStatement();
        ResultSet rs = stmt.executeQuery("select * from emp");

        while (rs.next()) {
            out.println(rs.getString(1) + " : ");
            out.println(rs.getString(2) + " : ");
            out.println(rs.getString(3) + " : ");
            out.println(rs.getString(4) + " <br> ");
        }

        rs.close();
        stmt.close();
        conn.close();
        %>
    </body>
    </html>
    ~~~

    ~~~ jsp
    <%@ page language="java" contentType="text/html; charset=EUC-KR"
        pageEncoding="EUC-KR"%>
    <%@ page import="java.sql.*, java.util.*"%>
    <%@ page import="javax.naming.*"%>
    <%@ page import="javax.sql.DataSource"%>

    <!DOCTYPE html>
    <html>
    <head>
    <meta charset="EUC-KR">
    <title>Insert title here</title>
    </head>
    <body>

        <%
        Context initContext = new InitialContext();
        Context envContext = (Context) initContext.lookup("java:/comp/env");
        DataSource ds = (DataSource) envContext.lookup("jdbc/myoracle");
        Connection conn = ds.getConnection();

        if (!conn.isClosed()) {
            out.println("데이터 베이스 연결 성공했습니다.<br>");
        }

        Statement stmt = conn.createStatement();
        ResultSet rs = stmt.executeQuery("select * from emp");

        while (rs.next()) {
            out.println(rs.getString(1) + " : ");
            out.println(rs.getString(2) + " : ");
            out.println(rs.getString(3) + " : ");
            out.println(rs.getString(4) + " <br> ");
        }

        rs.close();
        stmt.close();
        conn.close();
        %>

    </body>
    </html>
    ~~~
























