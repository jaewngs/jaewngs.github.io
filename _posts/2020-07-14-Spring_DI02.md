---



title:  "Spring DI(Dependency Injection)02"



layout: post



---


## [오늘 할 내용]
1. com.test01 : Spring beans 설정 연습
2. com.test01.Anno : Spring Annotation 설정
3. com.test02 : @Autowired를 setter, construct로 지정
4. com.test03 : annotation @Component @Lazy
5. com.test04
	- @Resource : 의존하는 빈 객체를 전달할 때 사용함
		- ex) @Component("userService")
			- <bean id = "userService" class "UserService" />
		- @Resource(name = "myuser") ..........	private MyUser mytest; 랑
		- MyUser myuser  = new MyUser(); ..........  mytest = myuser; 랑 같음
		- Stereotype-annotation
			- @Component : 자동인식이 되는 일반 컴포넌트 <bean/>
			- @Service : 비즈니스 서비스 (BIZ)
			- @Repository : DAO (DBException 자동처리)
			- @Controller : MVC 컴포넌트
6. com.test05
	- AnnotationConfigApplicationContext();을 사용해서 @Configuration를 선언 후 호출
	- @Scope("prototype | singleton") : nonstatic | static
	- prototype : 하나의 Bean 정의에 대해서 다수의 객체가 존재할 수 있음 (nonstatic)
	- singleton : 하나의 Bean 정의에 대해서 Spring IoC Container 내에 단 하나의 객체만 존재 (static)
	- 특정 bean을 호출할 때 사용하는 어노테이션
        - @Inject
            - 참고하고자 하는 bean을 직접 injection하지 않고 클래스 타입에 Object<T> 대한 injection을 한다.
            - 객체 값을 리턴하는 get()메소드에서 사용된다.(JSR330)
            - ex)
                ~~~ java
                Mydate<address> m = {address(0), ,,, }
                m.get(0);
                m.get(); // 전체 리턴하는 구조를 가진 메소드
                ~~~

                ~~~ java
                class Test{
                    @Inject
                    private Mydate<address> mydate;

                    public void setMydate(Mydate<address>  d){
                    this.mydate = d;
                    }
                    public address getMydate(){
                    return mydate<address>.get() ;
                    }
                }
                ~~~
            - DefaultListableBeanFactory의 DependencyProvider라는 클래스의 구현체만 사용할 수 있다.

        - @Autowired : 서로 다른 bean간의 의존성을 위한 어노테이션
            - ex) 입력 파라미터가 1개인 setter메소드, 일반 메소드, 생성자, 멤버변수, 배열, 컬렉션 등
        - [@Qualifier : 강제가 아님]
            - ex)
                ~~~ java
                class Test{
                    @Autowired
                    @Qualifier("abc")  // abc의 bean이 선언된 Date로 injection
                    private Date mydate; // <bean id ="abc" class = "Date" p:year = "2020"/>가 있다고 간주
                }
                ~~~

        - @Resource : 멤버 변수, setter에만 선언되는 또 다른 bean을 설정한다.
            - ex)
                ~~~ java
                class Test{
                    @Resource("d1") // <bean id = "d1" class="Date" p:year="2040"/>
                    private Date mydate;  // Date이름은 bean의 d1이 되는 것임

                    // 여기에 값을 전달한 것과 같음
                    /* public void setDate(Date mydate){
                        this.mydate = mydate;
                    } */

                    @Resource(name="myaddr") // private Address address; 걸었다고 생각
                    public void setAddress(Address addr){

                    }
                ~~~
        - Spring 2.5부터 어노테이션 개발되어 3.0에 안정적,활성화
        - @Inject (JSR-330) : type따라 움직임, Spring에 종속적이지 않음, @Named 특정 bean을 사용
        - @Autowired : type따라 움직임, Spring에 종속, @Qualifier를 사용해서 특정 BEAN을 지정
        - @Resource (JSR-250) : name따라 움직임, Spring에 종속적이지 않음, 선언이 한정적

7. com.test06 : beans.xml -> AppConfig로 변환 후 MTest02에서 호출
8. com.test07
	- 초기화, 소멸화 메소드를 명시할 수 있다.
		~~~ java
        <bean init-method = "" destroy-method=""/>
        @PostConstruct : 초기화 메소드
        @PreDestroy : 소멸화 메소드
        ~~~
	- Auto-Detecting 속성 지정
        ~~~ xml
        <context:component-scan> // 속성
        <!-- base-package
         (주로 사용)user-default-filters : Stereotype-annotation 등록시 기본 필터를 사용하지 않고자 할 때 filter
        annotation-config[MVC 지정]: Stereotype-annotation을 제외한 어노테이션을 처리하지 않을 때 false
         scope-resolver : Bean Score Annotation이 아닌 다른 방법으로 정의 시 클래스를 지정
         ex) <context:component-scan scope-resolver = "com.test.Rest"/>

         scoped-proxy : Non-singleton bean을 singleton bean이 참조할 때 사용
              			no | interface(자바의 다형성 객체를 만들어서 참조) | targetClass(또 다른 클래스)

        (주로 사용) name-generator : Stereotype-annotation을 적용한 클래스를 bean으로 등록할 때 BeanName을 지정하지 않을 경우 자동으로 생성되는 BeanName의 형식을 BeanNameGenerator을 구현하여 사용
         ex) <context:component-scan name-generator = "com.test.Controller"/>
         ex) vo -> entity -> dto -->
        ~~~

	- component-scan
		~~~ xml
	<context:component-scan>
    <!-- inner tag : 현재 사용되는 지정된 패키지에 추가하거나 빼고 싶은 대상을 지정한다.
    	type : annotation | assignable | regex | aspectj(AOP) -->
	<context:exclude-filter type="regex" expression="*.*Stub"/>
<context:include-filter type="annotation" expression="org.springframework.stereotype.Repository"/>
</context:component-scan>
		~~~

***

## com.test01

- Nic_name.java

    ~~~ java
    package com.test01;

    public class Nic_name {
        @Override
        public String toString() {
            return "Nic_name [toString() = 별명은 멍멍이";
        }
    }
    ~~~

- Nic_namePrn.java

    ~~~ java
    package com.test01;

    public class Nic_namePrn {
        private Nic_name nic_name;

        public void setNic_name(Nic_name nic_name) {
            this.nic_name = nic_name;
        }

        @Override
        public String toString() {
            return "Nic_namePrn [nic_name=" + nic_name + "]";
        }
    }
    ~~~

- beans.xml

    ~~~ xml
    <?xml version="1.0" encoding="UTF-8"?>
    <beans xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

        <bean id="mynamePrn" class="com.test01.Nic_namePrn">
            <property name="nic_name" ref="myname" />
        </bean>

        <bean id="myname" class="com.test01.Nic_name" />
    </beans>
    ~~~

- MTest.java

    ~~~ java
    package com.test01;

    import org.springframework.context.ApplicationContext;
    import org.springframework.context.support.ClassPathXmlApplicationContext;

    public class MTest {
        public static void main(String[] args) {
            ApplicationContext context 
            = new ClassPathXmlApplicationContext(new String[] { "com/test01/beans.xml" });

            Nic_namePrn prn = (Nic_namePrn) context.getBean("mynamePrn");

            System.out.println(prn);
        }
    }
    ~~~

	![image](https://user-images.githubusercontent.com/52989294/87417202-cbd61900-c60a-11ea-85b8-e0432c351521.png)

***

## com.test01.Anno

- Nic_name.java

    ~~~ java
    package com.test01.Anno;

    import org.springframework.stereotype.Component;

    @Component
    public class Nic_name {
        @Override
        public String toString() {
            return "Nic_name [toString() = 별명은 멍멍이";
        }
    }
    ~~~

- Nic_namePrn.java

    ~~~ java
    package com.test01.Anno;

    import org.springframework.stereotype.Component;

    @Component
    public class Nic_name {
        @Override
        public String toString() {
            return "Nic_name [toString() = 별명은 멍멍이";
        }
    }
    ~~~

- beans.xml

    ~~~ xml
    <?xml version="1.0" encoding="UTF-8"?>
    <beans xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:context="http://www.springframework.org/schema/context"
        xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
            http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd">

        <context:component-scan
            base-package="com.test01.Anno" />
    </beans>
    ~~~

- MTest.java

    ~~~ java
    <?xml version="1.0" encoding="UTF-8"?>
    <beans xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:context="http://www.springframework.org/schema/context"
        xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
            http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd">

        <context:component-scan
            base-package="com.test01.Anno" />
    </beans>
    ~~~

	![image](https://user-images.githubusercontent.com/52989294/87417129-b2cd6800-c60a-11ea-99c4-2e1cb64db1ff.png)

***

## com.test02
- Student.java

    ~~~ java
    package com.test02;

    import org.springframework.stereotype.Component;

    @Component
    public class Student {
        private String name;
        private String address;
        private int age;

        public void setName(String name) {
            this.name = name;
        }

        public void setAddress(String address) {
            this.address = address;
        }

        public void setAge(int age) {
            this.age = age;
        }

        @Override
        public String toString() {
            return "Student [name=" + name + ", address=" + address + ", age=" + age + "]";
        }
    }
    ~~~

- School.java

    ~~~ java
    package com.test02;

    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.stereotype.Component;

    @Component("my_school")
    public class School {
        @Autowired
        private Student person;
        private int grade;

        public void setGrade(int grade) {
            this.grade = grade;
        }


        @Override
        public String toString() {
            return "School [person=" + person + ", grade=" + grade + "]";
        }
    }
    ~~~

- beans.xml

    ~~~ xml
    <?xml version="1.0" encoding="UTF-8"?>
    <beans xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:context="http://www.springframework.org/schema/context"
        xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
            http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd">

        <context:annotation-config/>

        <bean class="com.test02.Student" id="mystudent">
            <property value="길동" name="name" />
            <property value="address 서울" name="address" />
            <property value="29" name="age" />
        </bean>

        <bean class="com.test02.School" id="my_school">
            <property value="1" name="grade" />
        </bean>
    </beans>
    ~~~

- MTest.java

    ~~~ java
    <?xml version="1.0" encoding="UTF-8"?>
    <beans xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:context="http://www.springframework.org/schema/context"
        xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
            http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd">

        <context:annotation-config/>

        <bean class="com.test02.Student" id="mystudent">
            <property value="길동" name="name" />
            <property value="address 서울" name="address" />
            <property value="29" name="age" />
        </bean>

        <bean class="com.test02.School" id="my_school">
            <property value="1" name="grade" />
        </bean>
    </beans>
    ~~~

	![image](https://user-images.githubusercontent.com/52989294/87417400-135ca500-c60b-11ea-8332-c2cfd46df6f7.png)

***

## com.test03

- TV.java

    ~~~ java
    package com.test03;

    public interface TV {
        public void powerOn();
        public void powerOff();
        public void volumnDown();
        public void volumnUp();
    }
    ~~~

- LgTv.java

    ~~~ java
    package com.test03;

    import org.springframework.stereotype.Component;

    @Component("mylg")
    public class LgTV implements TV{

        public LgTV() {
            super();
            System.out.println("엘지 TV 생성자");
        }

        @Override
        public void powerOn() {
            System.out.println("LgTV --- 전원 켠다.");
        }

        @Override
        public void powerOff() {
            System.out.println("LgTV --- 전원 끈다.");
        }

        @Override
        public void volumnDown() {
            System.out.println("LgTV --- 소리 낮춘다.");
        }

        @Override
        public void volumnUp() {
            System.out.println("LgTV --- 소리 높인다.");
        }
    }
    ~~~

- SamsungTV.java

    ~~~ java
    package com.test03;

    import org.springframework.context.annotation.Lazy;
    import org.springframework.stereotype.Component;

    @Lazy
    @Component("mysamsung")
    public class SamsungTV implements TV {

        public SamsungTV() {
            super();
            System.out.println("삼성 TV 생성자");
        }

        @Override
        public void powerOn() {
            System.out.println("SamsungTV --- 전원 켠다.");
        }

        @Override
        public void powerOff() {
            System.out.println("SamsungTV --- 전원 끈다.");
        }

        @Override
        public void volumnDown() {
            System.out.println("SamsungTV --- 소리 낮춘다.");
        }

        @Override
        public void volumnUp() {
            System.out.println("SamsungTV --- 소리 높인다.");
        }
    }
    ~~~

- beans.xml

    ~~~ xml
    <?xml version="1.0" encoding="UTF-8"?>
    <beans xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:context="http://www.springframework.org/schema/context"
        xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
            http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd">

        <context:component-scan
            base-package="com.test03" />
    </beans>
    ~~~

- MTest.java

    ~~~ java
    package com.test03;

    import org.springframework.context.ApplicationContext;
    import org.springframework.context.support.ClassPathXmlApplicationContext;

    public class MTest {
        public static void main(String[] args) {
            // 실제로 실행되는 클래스의 타입을 실행시켜 준다.
            ApplicationContext factory = new ClassPathXmlApplicationContext("com/test03/beans.xml");
            TV tv = (TV) factory.getBean("mysamsung");
            tv.powerOn();
            tv.volumnUp();
            tv.volumnDown();
            tv.powerOff();
        }
    }
    ~~~

	![image](https://user-images.githubusercontent.com/52989294/87497564-bb688180-c690-11ea-8177-8b1913f300fc.png)

***

## com.test04

- UserService.java

    ~~~ java
    package com.test04;

    public interface UserService {
        public void addUser();
    }
    ~~~

- UserServiceImpl.java

    ~~~ java
    package com.test04;

    import javax.annotation.Resource;
    import org.springframework.stereotype.Component;

    @Component("userService")
    public class UserServiceImpl implements UserService {

        @Resource(name = "myuser")
        UserVo member; // UserVo member = new UserVo()와 같다.
                        // member = myuser;

        @Override
        public void addUser() {
            System.out.println("추가된 멤버 : " + member.getUserName());
        }
    }
    ~~~

- UserVo.java

    ~~~ java
    package com.test04;

    import org.springframework.stereotype.Service;

    @Service
    public class UserVo {
        private String userName;

        public UserVo() {
        }

        public UserVo(String userName) {
            this.userName = userName;
        }

        public String getUserName() {
            return userName;
        }
    }
    ~~~

- applicationContext.xml

    ~~~ xml
    <?xml version="1.0" encoding="UTF-8"?>
    <beans xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:context="http://www.springframework.org/schema/context"
        xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
            http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd">

        <context:component-scan
            base-package="com.test04" />
        <bean id="myuser" class="com.test04.UserVo">
            <constructor-arg value="홍길동" />
        </bean>
    </beans>
    ~~~

- MTest.java

    ~~~ java
    package com.test04;

    import org.springframework.context.ApplicationContext;
    import org.springframework.context.support.ClassPathXmlApplicationContext;

    public class MTest {
        public static void main(String[] args) {
            ApplicationContext factory = new ClassPathXmlApplicationContext("com/test04/applicationContext.xml");
            UserService u1 = factory.getBean("userService", UserService.class);
            u1.addUser();
        }
    }
    ~~~

	![image](https://user-images.githubusercontent.com/52989294/87497482-983dd200-c690-11ea-97fa-f89ee84fb8c5.png)

***

## com.test05

- MyTest.java

    ~~~ java
    package com.test05;

    public interface MyTest {

    }
    ~~~

- MyTestImple.java

    ~~~ java
    package com.test05;

    public class MyTestImple implements MyTest {

        @Override
        public String toString() {
            return "MyTestImple [getClass()=" + getClass() + ", hashCode()="
                    + hashCode() + ",\n toString()="
                    + super.toString() + "]";
        }
    }
    ~~~

- AppConfig.java

    ~~~ java
    package com.test05;

    import org.springframework.context.annotation.Bean;
    import org.springframework.context.annotation.ComponentScan;
    import org.springframework.context.annotation.Configuration;

    @Configuration // applicationContext.xml로 간주됨
    @ComponentScan(basePackages = "com.test05")
    public class AppConfig {
        @Bean(name = { "a", "b" })  // 객체 생성
        public MyTest myService() {
            return new MyTestImple();
        }
    }
    ~~~

- MyMessage.java

    ~~~ java
    package com.test05;

    import org.springframework.context.annotation.Scope;
    import org.springframework.stereotype.Component;

    @Component("mymessage")
    @Scope("prototype")  // 또는  @Scope("singleton") ... @Scope안쓰면 default로 "singleton"
    public class MyMessage {
        String message;

        public MyMessage() {
            message = "myTest Message : ";
        }

        public String getMessage() {
            return message;
        }

        public void setMessage(String message) {
            this.message = message;
        }
    }
    ~~~

- MTest.java

    ~~~ java
    package com.test05;

    import org.springframework.context.annotation.AnnotationConfigApplicationContext;
    import org.springframework.context.annotation.Scope;

    public class MTest {
        public static void main(String[] args) {
            // 여기서 @Configuration를 찾음 --> AppConfig.java
            AnnotationConfigApplicationContext ctx = new AnnotationConfigApplicationContext();
            ctx.scan("com.test05"); // 기본 패키지에 선언된 값을 리턴받아 사용함
            ctx.refresh(); // 새로고침

            // ctx.scan("com.test05.biz");
            // ctx.refresh();

            //MyTestImple myTest = ctx.getBean(MyTestImple.class);
            //System.out.println(myTest);

            // MyMessage.java에 @Scope("prototype")을 주면 nonstatic이기 때문에 주소값 다 다름
            // MyMessage.java에 @Scope("singleton")을 주면 static이기 때문에 주소값 다 같음
            MyMessage res = ctx.getBean("mymessage", MyMessage.class);
            System.out.println("주소 : " + res.toString());

            MyMessage res01 = ctx.getBean("mymessage", MyMessage.class);
            System.out.println("주소 : " + res01.toString());

            MyMessage res02 = ctx.getBean("mymessage", MyMessage.class);
            System.out.println("주소 : " + res02.toString());
        }
    }
    ~~~

	![image](https://user-images.githubusercontent.com/52989294/87497429-7e9c8a80-c690-11ea-8ddb-4bc20af1390d.png)

***

## com.test06

- Person.java

    ~~~ java
    package com.test06;

    import org.springframework.context.annotation.Scope;

    @Scope("singleton")
    public class Person {
        private String name;

        public String getName() {
            return name;
        }

        public void setName(String name) {
            this.name = name;
        }

        @Override
        public String toString() {
            return "Person [name=" + name + "]" + super.toString();
        }
    }
    ~~~

- PersonPrn.java

    ~~~ java
    package com.test06;

    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.beans.factory.annotation.Qualifier;
    import org.springframework.context.annotation.Scope;
    import org.springframework.stereotype.Component;

    @Component("mTest")
    public class PersonPrn {

        @Autowired // setter 대신 사용, 같은 type만 있으면 자동으로 set, 생성자 등으로 값 대입함
        @Qualifier("personA")
        private Person person;

        public Person getPerson() {
            return person;
        }

        @Override
        public String toString() {
            return "Customer [person=" + person + "]";
        }
    }
    ~~~

- beans.xml

    ~~~ xml
    <?xml version="1.0" encoding="UTF-8"?>
    <beans xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:context="http://www.springframework.org/schema/context"
        xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
            http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd">


        <context:component-scan
            base-package="com.test06" />
        <bean class="com.test06.Person" id="personA">
            <property value="홍길동" name="name" />
        </bean>

        <!-- 최길동 출력하려면 위에 <bean>, PersonPrn에서 @Qualifier("personA") 주석처리 -->
        <bean class="com.test06.Person" id="personB">
            <property value="최길동" name="name" />
        </bean>

        <bean class="com.test06.Person" id="personC">
            <property value="최길동" name="name" />
        </bean>

        <bean class="com.test06.Person" id="personD">
            <property value="박길동" name="name" />
        </bean>

    </beans>
    ~~~

- AppConfig.java

    ~~~ java
    package com.test06;

    import org.springframework.context.annotation.Bean;
    import org.springframework.context.annotation.ComponentScan;
    import org.springframework.context.annotation.Configuration;

    @Configuration // applicationContext.xml로 간주됨
    @ComponentScan(basePackages = "com.test06")
    public class AppConfig {
        @Bean("personA") // 객체 생성
        public Person getPerSon() {
            Person p1 = new Person();
            p1.setName("홍길동");
            return p1;
        }

        @Bean({ "personB", "personC" }) // 객체 생성
        public Person getPerson() {
            Person p2 = new Person();
            p2.setName("최길동");
            return p2;
        }

        @Bean("personD") // 객체 생성
        public Person getPERSON() {
            Person p2 = new Person();
            p2.setName("박길동");
            return p2;
        }
    }
    ~~~

- MTest.java

    ~~~ java
    package com.test06;

    import org.springframework.context.ApplicationContext;
    import org.springframework.context.support.ClassPathXmlApplicationContext;

    public class MTest {
        public static void main(String[] args) {
            ApplicationContext ctx = new ClassPathXmlApplicationContext("com/test06/beans.xml");
            PersonPrn cust = (PersonPrn) ctx.getBean("mTest");
            System.out.println(cust);

            PersonPrn cust1 = (PersonPrn) ctx.getBean("mTest");
            System.out.println(cust.toString());

            Person p1 = ctx.getBean("personA", Person.class);
            System.out.println(p1);

            p1 = ctx.getBean("personB", Person.class);
            System.out.println(p1);

            p1 = ctx.getBean("personC", Person.class);
            System.out.println(p1);

            p1 = ctx.getBean("personD", Person.class);
            System.out.println(p1);

            p1 = ctx.getBean("personD", Person.class);
            System.out.println(p1);
        }
    }
	~~~

- MTest02.java

    ~~~ java
    package com.test06;

    import org.springframework.context.annotation.AnnotationConfigApplicationContext;

    public class MTest02 {
        public static void main(String[] args) {
            AnnotationConfigApplicationContext ctx = new AnnotationConfigApplicationContext();
            ctx.scan("com.test06"); // 기본 패키지에 선언된 값을 리턴받아 사용함
            ctx.refresh(); // 새로고침

            PersonPrn cust = (PersonPrn) ctx.getBean("mTest");
            System.out.println(cust.toString());

            Person p1 = ctx.getBean("personA", Person.class);
            System.out.println(p1);

            Person p2 = ctx.getBean("personB", Person.class);
            System.out.println(p2);

            Person p3 = ctx.getBean("personC", Person.class);
            System.out.println(p3);

            Person p4 = ctx.getBean("personD", Person.class);
            System.out.println(p4);

            Person p5 = ctx.getBean("personD", Person.class);
            System.out.println(p5);

        }
    }
    ~~~

***

## com.test07

- MethodTest.java

    ~~~ java
    package com.test07;

    import javax.annotation.PostConstruct;
    import javax.annotation.PreDestroy;

    import org.springframework.stereotype.Component;

    @Component
    public class MethodTest {

        public MethodTest() {
            System.out.println("생성자");
        }

        @PostConstruct
        public void Init() {
            System.out.println("초기화");
        }

        @PreDestroy
        public void Dispose() {
            System.out.println("소멸화");
        }

        @PreDestroy
        public void Dispose2() {
            System.out.println("소멸화2");
        }
    }
    ~~~


- beans.xml

    ~~~ xml
    <?xml version="1.0" encoding="UTF-8"?>
    <beans xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:context="http://www.springframework.org/schema/context"
        xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
            http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd">

        <context:component-scan
            base-package="com.test07" />

        <!-- <bean class="com.test07.MethodTest" id="A_test" init-method="Init"
            destroy-method="Dispose" /> -->
    </beans>
    ~~~

- MTest.java

    ~~~ java
    package com.test07;

    import org.springframework.context.ApplicationContext;
    import org.springframework.context.support.AbstractApplicationContext;
    import org.springframework.context.support.ClassPathXmlApplicationContext;

    public class MTest {
        public static void main(String[] args) {
            ApplicationContext ctx = new ClassPathXmlApplicationContext("com/test07/beans.xml");
            MethodTest res = ctx.getBean("methodTest", MethodTest.class);
            ((AbstractApplicationContext) ctx).close();
        }
    }
    ~~~

***

## com.test08
- Student.java

    ~~~ java
    package com.test08;

    import org.springframework.beans.factory.annotation.Value;
    import org.springframework.context.annotation.ImportResource;

    @ImportResource("classpath:/com/test08/AppConfig")
    public class Student {
        @Value("${myname}")
        private String name;

        @Value("${myaddr}")
        private String address;

        @Value("${myage}")
        private int age;

        public String getName() {
            return name;
        }

        public void setName(String name) {
            this.name = name;
        }

        public String getAddress() {
            return address;
        }

        public void setAddress(String address) {
            this.address = address;
        }

        public int getAge() {
            return age;
        }

        public void setAge(int age) {
            this.age = age;
        }

        @Override
        public String toString() {
            return "Student [name=" + name + ", address=" + address + ", age=" + age + "]";
        }
    }
    ~~~

- School.java

    ~~~ java
    package com.test08;

    import org.springframework.beans.factory.annotation.Autowired;

    public class School {

        @Autowired
        private Student person;
        private int grade;

        public int getGrade() {
            return grade;
        }

        public void setGrade(int grade) {
            this.grade = grade;
        }

        public Student getPerson() {
            return person;
        }

        @Override
        public String toString() {
            return "School [person=" + person + ", grade=" + grade + "]";
        }

    }
    ~~~

- AppConfig.java

    ~~~ java
    package com.test08;

    import org.springframework.context.annotation.Bean;
    import org.springframework.context.annotation.Configuration;
    import org.springframework.context.annotation.DependsOn;
    import org.springframework.context.annotation.PropertySource;

    @Configuration
    @PropertySource("classpath:/com/test08/a.properties")
    public class AppConfig {
        @Bean(name = "school")
        @DependsOn("student")
        public School getSchool() {
            School sm = new School();
            sm.setGrade(3);
            return sm;
        }

        @Bean(name = "student")
        public Student getStudent() {
            Student s = new Student();
            s.setAddress("서울");
            s.setAge(20);
            return s;
        }
    }
    ~~~

- a.properties

    ~~~ properties
    myname=\uD64D\uAE38\uB3D9
    myaddr=\uC0BC\uAD6D\uC2DC\uB300
    myage=90
    ~~~

- MTest.java

    ~~~ java
    package com.test08;

    import org.springframework.context.annotation.AnnotationConfigApplicationContext;

    public class MTest {
        public static void main(String[] args) {
            AnnotationConfigApplicationContext ctx = new AnnotationConfigApplicationContext();
            ctx.register(AppConfig.class);
            ctx.refresh();

            School st = (School) ctx.getBean("school");
            System.out.println(st.toString());
        }
    }
    ~~~

	![image](https://user-images.githubusercontent.com/52989294/87526422-c1c52080-c6c5-11ea-825c-0deac3ccd2c0.png)

***

## Day29를 Maven Project(Spring)로 바꾸기

- MyEmpVO.java(VO)

    ~~~ java
    package com.vo;

    import org.springframework.stereotype.Component;

    @Component
    public class MyEmpVO {
    //EMPNO, ENAME, DEPTNO
        private int empno;
        private String name;
        private int deptno;

        public MyEmpVO() {
            super();
        }

        public MyEmpVO(int empno, String name, int deptno) {
            super();
            this.empno = empno;
            this.name = name;
            this.deptno = deptno;
        }

        public int getEmpno() {
            return empno;
        }

        public void setEmpno(int empno) {
            this.empno = empno;
        }

        public String getName() {
            return name;
        }

        public void setName(String name) {
            this.name = name;
        }

        public int getDeptno() {
            return deptno;
        }

        public void setDeptno(int deptno) {
            this.deptno = deptno;
        }

        @Override
        public String toString() {
            return String.format("MyEmpVO [empno=%s, name=%s, deptno=%s]", empno, name, deptno);
        }
    }
    ~~~

- MyEmpMenu.java(VIEW)

    ~~~ java
    package com.view;

    import java.util.List;
    import java.util.Scanner;

    import org.springframework.stereotype.Component;

    import com.biz.MyEmpBIZ;
    import com.vo.MyEmpVO;

    @Component
    public class MyEmpMenu {
        static Scanner sc = new Scanner(System.in);

        public static int getMenu() {
            StringBuilder sb = new StringBuilder();
            sb.append(" ===== menu ===== \n");
            sb.append("1. MyEmp Insert \n");
            sb.append("2. MyEmp Delete \n");
            sb.append("3. MyEmp Update \n");
            sb.append("4. MyEmp SelectAll \n");
            sb.append("5. exit ");

            System.out.println(sb.toString());
            System.out.print("input no : ");
            int no = sc.nextInt();

            return no;
        }

        public static void Update(MyEmpBIZ biz) {
            // 1. 데이터를 Scanner로 입력을 받자.
            Scanner sc = new Scanner(System.in);

            System.out.println("find empno : ");
            int empno = sc.nextInt();

            System.out.println("update ename : ");
            String name = sc.next();

            System.out.println("update deptno : ");
            int deptno = sc.nextInt();

            // 2. 입력받은 데이터를 VO에 저장한다.
            MyEmpVO vo = new MyEmpVO();
            vo.setEmpno(empno);
            vo.setDeptno(deptno);
            vo.setName(name);

            // 3. view -> Controller에서 <-> Biz로 전송 <-> DAO 전송
            int res = biz.getUpdate(vo);
            if (res > 0) {
                System.out.println("업데이트 성공 ㅎㅎㅎ");
            }
        }

        public static void Delete(MyEmpBIZ biz) {
            // 1. 삭제할 번호를 입력 받는다.
            int empno = 0;
            Scanner sc = new Scanner(System.in);
            System.out.println("input delno : ");
            empno = sc.nextInt();

            // 2. vo 객체에 저장한다.
            MyEmpVO vo = new MyEmpVO();
            vo.setEmpno(empno);

            // 3. vo -> biz에 보낸 후 결과를 리턴받는다.
            int res = biz.getDeleteEmpno(vo);
            // 4. 결과를 출력한다. '삭제 성공이야!';
            if (res > 0) {
                System.out.println("삭제 성공이야!");
            }
        }

        public static void Insert(MyEmpBIZ biz) {
            // 1. 데이터를 Scanner로 입력을 받자.
            Scanner sc = new Scanner(System.in);
            System.out.println("input empno : ");
            int empno = sc.nextInt();

            System.out.println("\n input ename : ");
            String name = sc.next();

            System.out.println("\n input deptno : ");
            int deptno = sc.nextInt();

            // 2. 입력받은 데이터를 VO에 저장한다.
            MyEmpVO vo = new MyEmpVO(empno, name, deptno);

            // 3. view -> Controller에서 <-> Biz로 전송 <-> DAO 전송
            int res = biz.getInsert(vo);
            if (res > 0) {
                System.out.println("입력 성공 ㅎㅎㅎ");
            }
        }

        public static void SelectAll(MyEmpBIZ biz) {
            List<MyEmpVO> all = biz.getAll_MyEmp();
            for (MyEmpVO res : all) {
                System.out.println(res);
            }
        }
    }
    ~~~

- MyEmpDAO.java(DAO)

    ~~~ java
    package com.dao;

    import java.sql.*;
    import java.util.*; //  List<MyEmpVo>  all;

    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.stereotype.Repository;

    import com.vo.*;

    import common.JDBCTemplate;

    @Repository("dao")
    public class MyEmpDAO implements MyEmpSql {
        @Autowired
        JDBCTemplate jDBCTemplate;
        Connection conn;

        public List<MyEmpVO> getAll_MyEmp() {
            MyEmpVO vo = null;
            List<MyEmpVO> all = new ArrayList<>();

            // 명령을 수행하는 객체생성
            Statement stmt = null;

            // 결과, select 실행 후 데이터를 리턴 받을 객체
            ResultSet rs = null;

            try {
                conn = jDBCTemplate.getConnection();
                stmt = conn.createStatement(); // 명령실행 준비
                rs = stmt.executeQuery(myemp_all); // select 문을 실행 후 결과를 리턴
                while (rs.next()) {
                    // 결과를 한줄씩 읽어서 vo에 담는다.
                    vo = new MyEmpVO(rs.getInt(1), rs.getString(2), rs.getInt(3));

                    // List 객체에 추가한다.
                    all.add(vo);
                }

            } catch (Exception e) {
                System.out.println(e);
            } finally {
                jDBCTemplate.Close(rs);
                jDBCTemplate.Close(stmt);
                jDBCTemplate.Close(conn);
            }
            return all;
        } // end method

        public MyEmpVO getAll_VO(String name) {
            PreparedStatement pstm = null;
            ResultSet rs = null;
            MyEmpVO vo = null;

            try {
                conn = jDBCTemplate.getConnection();
                pstm = conn.prepareStatement(myemp_vo);
                pstm.setString(1, name);
                rs = pstm.executeQuery();
                while (rs.next()) {
                    vo = new MyEmpVO(rs.getInt(1), rs.getString(2), rs.getInt(3));
                }
            } catch (Exception e) {
                System.out.println(e.toString());
            } finally {
                jDBCTemplate.Close(rs);
                jDBCTemplate.Close(pstm);
                jDBCTemplate.Close(conn);
            }
            return vo;
        }

        public MyEmpVO getAll_VO002(MyEmpVO input_vo) {
            PreparedStatement pstm = null;
            ResultSet rs = null;
            MyEmpVO vo = null;

            try {
                conn = jDBCTemplate.getConnection();
                pstm = conn.prepareStatement(myemp_vo2);
                pstm.setString(1, input_vo.getName());
                pstm.setInt(2, input_vo.getEmpno());

                rs = pstm.executeQuery();
                while (rs.next()) {
                    vo = new MyEmpVO(rs.getInt(1), rs.getString(2), rs.getInt(3));
                }
            } catch (Exception e) {
                System.out.println(e.toString());
            } finally {
                jDBCTemplate.Close(rs);
                jDBCTemplate.Close(pstm);
                jDBCTemplate.Close(conn);
            }
            return vo;
        }

        /// INSERT
        public int getInsertVO(MyEmpVO vo) {
            int res = 0;
            PreparedStatement pstm = null;

            try {
                conn = jDBCTemplate.getConnection();
                pstm = conn.prepareStatement(myemp_insert); // 쿼리 호출
                // ? 매개인자에 값 대입
                pstm.setInt(1, vo.getEmpno());
                pstm.setString(2, vo.getName());
                pstm.setInt(3, vo.getDeptno());

                // 쿼리 실행
                res = pstm.executeUpdate();

                if (res > 0) {
                    System.out.println("입력 성공했다");
                    jDBCTemplate.Commit(jDBCTemplate.getConnection());
                }
            } catch (Exception e) {
                System.out.println(e.toString());
                jDBCTemplate.Rollback(jDBCTemplate.getConnection());
            } finally {
                jDBCTemplate.Close(pstm);
                jDBCTemplate.Close(conn);
            }

            return res;
        }

        /// DELETE
        public int getDeleteEmpnoVO(MyEmpVO vo) {
            int res = 0; // 삭제 결과 저장할 변수
            PreparedStatement pstm = null; // SQL문장에 ? 를 사용하고 있으니까
            // PreparedStatement 사용

            try {
                conn = jDBCTemplate.getConnection();
                pstm = conn.prepareStatement(myemp_delete); // 쿼리 호출
                // ? 매개인자에 값 대입
                pstm.setInt(1, vo.getEmpno());

                // 삭제 실행 후 결과를 리턴
                // 쿼리 실행
                res = pstm.executeUpdate(); // insert, delete, update query

                if (res > 0) {
                    System.out.println("삭제 성공했다");
                    jDBCTemplate.Commit(jDBCTemplate.getConnection()); // conn.commit();
                }
            } catch (Exception e) {
                System.out.println(e.toString());
                jDBCTemplate.Rollback(jDBCTemplate.getConnection());
            } finally {
                jDBCTemplate.Close(pstm);
                jDBCTemplate.Close(conn);
            }
            return res;
        } // end method

        public int getUpdateVO(MyEmpVO vo) {
            int res = 0; // 업데이트 결과 저장할 변수
            PreparedStatement pstm = null;

            try {
                conn = jDBCTemplate.getConnection();
                pstm = conn.prepareStatement(myemp_update); // 쿼리 호출
                // ? 매개인자에 값 대입
                pstm.setString(1, vo.getName());
                pstm.setInt(2, vo.getDeptno());
                pstm.setInt(3, vo.getEmpno());
                // 삭제 실행 후 결과를 리턴
                // 쿼리 실행
                res = pstm.executeUpdate(); // insert, delete, update query

                if (res > 0) {
                    System.out.println("업데이트 성공했다");
                    jDBCTemplate.Commit(jDBCTemplate.getConnection()); // conn.commit();
                } else {
                    System.out.println("바꿀게 없음");
                }
            } catch (Exception e) {
                System.out.println(e.toString());
                jDBCTemplate.Rollback(jDBCTemplate.getConnection());
            } finally {
                jDBCTemplate.Close(pstm);
                jDBCTemplate.Close(conn);
            }
            return res;
        } // end method
    } // end class
    ~~~

- MyEmpSql.java(SQL)

    ~~~ java
    package com.dao;

    public interface MyEmpSql {
        String myemp_all = "SELECT * FROM My_Emp";

        // ? 에 매개변수를 사용하겠다.
        String myemp_vo = "SELECT * FROM MY_EMP WHERE ENAME = ?";

        String myemp_vo2 = "SELECT * FROM MY_EMP WHERE ENAME = ? AND EMPNO = ?";

        /// INSERT, DELETE, UPDATE ///
        String myemp_insert = "INSERT INTO MY_EMP VALUES(?,?,?)";

        // EMPNO를 받아 삭제하자.
        String myemp_delete = "DELETE FROM MY_EMP WHERE EMPNO = ?";

        // 사원번호를 찾아서 이름과 부서번호를 수정하자.
        String myemp_update = "UPDATE MY_EMP SET ENAME = ?, DEPTNO = ? WHERE EMPNO = ?";
    }
    ~~~

- MyEmpBIZ.java(BIZ)

    ~~~ java
    package com.biz;

    import java.sql.*;
    import java.util.*;

    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.stereotype.Service;

    import com.vo.*;
    import com.dao.*;

    @Service("biz")
    public class MyEmpBIZ {
        @Autowired
        private MyEmpDAO dao;

        public List<MyEmpVO> getAll_MyEmp() {
            List<MyEmpVO> all = dao.getAll_MyEmp();
            return all;
        }

        public MyEmpVO getAll_VO(String name) {
            MyEmpVO res = dao.getAll_VO(name);
            return res;
        }

        public MyEmpVO getAll_VO002(MyEmpVO input_vo) {
            MyEmpVO res = dao.getAll_VO002(input_vo);
            return res;
        }

        public int getInsert(MyEmpVO vo) {
            int res = dao.getInsertVO(vo);
            return res;
        }

        public int getDeleteEmpno(MyEmpVO vo) {
            int res = dao.getDeleteEmpnoVO(vo);
            return res;
        }

        public int getUpdate(MyEmpVO vo) {
            int res = dao.getUpdateVO(vo);
            return res;
        }
    }
    ~~~

- JDBCTemplate.java

    ~~~ java
    package common;

    import java.sql.Connection;
    import java.sql.ResultSet;
    import java.sql.SQLException;
    import java.sql.Statement;

    import javax.sql.DataSource;

    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.stereotype.Component;

    @Component
    public class JDBCTemplate {

        @Autowired
        private DataSource dataSource;

        public DataSource getDataSource() {
            return dataSource;
        }

        public void setDataSource(DataSource dataSource) {
            this.dataSource = dataSource;
        }

        public Connection getConnection() {
            Connection con = null;
            try {
                con = dataSource.getConnection();
                con.setAutoCommit(false);
            } catch (SQLException e) {
                e.printStackTrace();
            }
            return con;
        }

        // 연결 객체를 받아서(연결한 상태를) close()하겠다.
        public void Close(Connection con) {
            try {
                if (!con.isClosed() && con != null) {
                    con.close();
                }
            } catch (SQLException e) {
                e.printStackTrace();
            }
        }

        public void Close(Statement stmt) {
            try {
                if (stmt != null) {
                    stmt.close();
                }
            } catch (SQLException e) {
                e.printStackTrace();
            }
        }

        public void Close(ResultSet rs) {
            try {
                if (rs != null) {
                    rs.close();
                }
            } catch (SQLException e) {
                e.printStackTrace();
            }
        }

        public void Commit(Connection con) {
            try {
                if (con != null && !con.isClosed()) {
                    con.commit();
                }
            } catch (SQLException e) {
                e.printStackTrace();
            }
        }

        public void Rollback(Connection con) {
            try {
                if (con != null && !con.isClosed()) {
                    con.rollback();
                }
            } catch (SQLException e) {
                e.printStackTrace();
            }
        }
    }
    ~~~

- MyEmpController.java(Controller)

    ~~~ java
    package com.control;

    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.stereotype.Controller;

    import com.biz.MyEmpBIZ;
    import com.view.MyEmpMenu;

    @Controller
    public class MyEmpController {

        @Autowired
        private MyEmpBIZ mybiz;

        public void Mycontroller() {
            int r = 0;
            do {
                r = MyEmpMenu.getMenu();
                switch (r) {
                case 1:
                    MyEmpMenu.Insert(mybiz);
                    break;
                case 2:
                    MyEmpMenu.Delete(mybiz);
                    break;
                case 3:
                    MyEmpMenu.Update(mybiz);
                    break;
                case 4:
                    MyEmpMenu.SelectAll(mybiz);
                    break;
                case 5:
                    System.out.print("%%종료%%");
                    System.exit(0);
                }

                System.out.println(r);
            } while (r != 5);
        }
    }
    ~~~

- beans.xml

    ~~~ xml
    <?xml version="1.0" encoding="UTF-8"?>
    <beans xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:context="http://www.springframework.org/schema/context"
        xmlns:c="http://www.springframework.org/schema/c"
        xmlns:jdbc="http://www.springframework.org/schema/jdbc"
        xsi:schemaLocation="http://www.springframework.org/schema/jdbc http://www.springframework.org/schema/jdbc/spring-jdbc-4.3.xsd
            http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
            http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd">
        <context:component-scan
            base-package="com.*,common" />

        <bean id="ds"
            class="org.springframework.jdbc.datasource.SimpleDriverDataSource">

            <property name="driverClass"
                value="oracle.jdbc.driver.OracleDriver" />
            <property name="url"
                value="jdbc:oracle:thin:@localhost:1521:XE" />
            <property name="username" value="big5" />
            <property name="password" value="admin1234" />
        </bean>

        <bean id="jDBCTemplate" class="common.JDBCTemplate">
            <property name="dataSource" ref="ds"></property>
        </bean>

    </beans>
    ~~~

- MTest.java(Main)

    ~~~ java
    package com.control;

    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.stereotype.Controller;

    import com.biz.MyEmpBIZ;
    import com.view.MyEmpMenu;

    @Controller
    public class MyEmpController {

        @Autowired
        private MyEmpBIZ mybiz;

        public void Mycontroller() {
            int r = 0;
            do {
                r = MyEmpMenu.getMenu();
                switch (r) {
                case 1:
                    MyEmpMenu.Insert(mybiz);
                    break;
                case 2:
                    MyEmpMenu.Delete(mybiz);
                    break;
                case 3:
                    MyEmpMenu.Update(mybiz);
                    break;
                case 4:
                    MyEmpMenu.SelectAll(mybiz);
                    break;
                case 5:
                    System.out.print("%%종료%%");
                    System.exit(0);
                }

                System.out.println(r);
            } while (r != 5);
        }
    }
    ~~~