---

title:  " 구현 해보기"

layout: post

---

# DAY 34
![image](https://user-images.githubusercontent.com/52989294/83466008-bff62380-a4b0-11ea-9c56-932cb79b42fa.png)
테스트 용 이미지


## [오늘 할 내용]
1. 프로시져 복습 및 연습문제


## PROCEDURE 복습

ex1) SMITH 급여 출력 PROCEDURE 생성하기
~~~ sql
CREATE OR REPLACE PROCEDURE SP_SALARY
IS
V_SAL EMP.ENAME%TYPE;
BEGIN
SELECT SAL INTO V_SAL
FROM EMP
WHERE ENAME ='SMITH';
DBMS_OUTPUT.PUT_LINE('SMITH의 급여'||V_SAL);
END;
/
 ~~~
 
~~~ sql
-- 실행
EXEC SP_SALARY
~~~

~~~ sql
-- 프로시저 생성 확인
SELECT NAME, TEXT FROM USER_SOURCE
WHERE NAME LIKE('%SP_SAL%');
~~~

~~~ sql
-- 프로시저 제거하기
DROP PROCEDURE SP_SALARY;
~~~

ex2) IN 매개변수 사용하기
~~~ sql
CREATE PROCEDURE SP_SAL_ENAME(
V_ENAME IN EMP.ENAME%TYPE)
IS
V_SAL EMP.SAL%TYPE;
BEGIN
SELECT SAL INTO V_SAL
FROM EMP
WHERE ENAME = V_ENAME;
DBMS_OUTPUT.PUT_LINE(V_ENAME||'의 급여'|| V_SALARY);
END;
/
~~~

~~~ sql
-- 실행
EXEC SP_SAL_ENAME('KING');
~~~

ex3) OUT 매개변수 사용하기
~~~ sql
CREATE PROCEDURE SP_SAL_ENAME2(
V_ENAME IN EMP.ENAME%TYPE,
V_SAL OUT EMP.SAL%TYPE)
IS
BEGIN
SELECT SAL INTO V_SAL
FROM EMP
WHERE ENAME = V_ENAME;
END;
/

~~~

~~~ sql
-- 실행
VAR V_SAL VARCHAR2(14);  -- 변수 생성
EXEC SP_SAL_ENAME2('KING',:V_SAL); -- 프로시져 결과 V_SAL에 저장

PRINT V_SAL;  -- 출력
~~~

ex4) FUNCTION문 사용하기
~~~ sql
CREATE OR REPLACE FUNCTION FN_SAL_ENAME(
V_ENAME IN EMP.ENAME%TYPE)
RETURN NUMBER
IS
V_SAL NUMBER(7,2);
BEGIN
SELECT SAL INTO V_SAL
FROM EMP
WHERE ENAME = V_ENAME;
RETURN V_SAL;
END;
/
~~~

~~~ sql
-- 실행
VAR V_SAL NUMBER;  -- 변수 생성
EXEC :V_SAL := FN_SAL_ENAME('KING');  -- 함수 리턴 값 V_SAL에 저장

PRINT V_SAL; -- 출력
~~~

~~~ sql
-- 함수 호출하기
SELECT ENAME, FN_SAL_ENAME('KING')
FROM EMP
WHERE ENAME = 'KING';
~~~

## PROCEDURE 연습 문제
Q1. 사원테이블의 사원번호와 이름을 출력하자. EX_VIEW01
~~~ sql
-- PROCEDURE
CREATE OR REPLACE PROCEDURE EX_VIEW01
IS
V_EMPNO EMP.EMPNO%TYPE;
V_ENAME EMP.ENAME%TYPE;

CURSOR RES IS -- 1. 커서 선언 : 하나 이상의 row를 담을 객체
SELECT EMPNO, ENAME FROM EMP;

BEGIN -- 실제 실행 코드
OPEN RES; -- 2. 커서 시작
LOOP -- 한줄 이상 대입 변수 출력 , loop 구문 사용
FETCH RES INTO V_EMPNO,V_ENAME; -- 3. 변수를 대입

EXIT WHEN RES%NOTFOUND;
DBMS_OUTPUT.PUT_LINE(V_EMPNO || '  '||V_ENAME);
END LOOP;
CLOSE RES;
END EX_VIEW01;
/
~~~

~~~ sql
EXEC EX_VIEW01 -- 실행
~~~

~~~ sql
-- FUNCTION 
CREATE OR REPLACE FUNCTION FN_VIEW01
RETURN SYS_REFCURSOR
IS
MYRES SYS_REFCURSOR;
BEGIN
OPEN MYRES FOR
SELECT EMPNO, ENAME FROM EMP;
RETURN MYRES;
END FN_VIEW01;
/
~~~

~~~ sql
VAR MYRES REFCURSOR;
EXEC :MYRES := FN_VIEW01();

PRINT MYRES;
~~~



Q2. 사원테이블에서 사원의 이름과 연봉을 구해서 리턴하자. EX_VIEW02
~~~ sql
-- PROCEDURE 방법1
CREATE OR REPLACE PROCEDURE EX_VIEW02
IS
V_ENAME EMP.ENAME%TYPE;
V_SAL EMP.SAL%TYPE;

CURSOR RES IS -- 1. 커서 선언 : 하나 이상의 row를 담을 객체
SELECT ENAME,SAL*12 FROM EMP;

BEGIN -- 실제 실행 코드
OPEN RES; -- 2. 커서 시작
LOOP -- 한줄 이상 대입 변수 출력 , loop 구문 사용
FETCH RES INTO V_ENAME, V_SAL; -- 3. 변수를 대입

EXIT WHEN RES%NOTFOUND;
DBMS_OUTPUT.PUT_LINE(V_ENAME || '  '||V_SAL);
END LOOP;
CLOSE RES;
END EX_VIEW02;
/
~~~

~~~ sql
EXEC EX_VIEW02
~~~

~~~ sql
-- PROCEDURE 방법2
CREATE OR REPLACE PROCEDURE EX_VIEW02(myres out SYS_REFCURSOR)
IS
BEGIN
OPEN myres FOR
SELECT ENAME, SAL * 12 FROM EMP;
END EX_VIEW02;
/
~~~

~~~ sql
var my refcursor;
exec ex_view02(:my)
print my
~~~

~~~ sql
-- FUNCTION 
CREATE OR REPLACE FUNCTION FN_VIEW02
RETURN SYS_REFCURSOR
IS
MYRES SYS_REFCURSOR;
BEGIN
OPEN MYRES FOR
SELECT ENAME, SAL * 12 FROM EMP;
RETURN MYRES;
END FN_VIEW02;
/
~~~

~~~ sql
VAR MYRES REFCURSOR;
EXEC :MYRES := FN_VIEW02();

PRINT MYRES;
~~~


Q3. 사원의 이름을 입력 받아 봉급과 커미션을 리턴하자. EX_VIEW03
~~~ sql
-- PROCEDURE 방법1
CREATE OR REPLACE PROCEDURE EX_VIEW03(V_ENAME IN EMP.ENAME%TYPE)
IS
V_SAL EMP.SAL%TYPE;
V_COMM EMP.COMM%TYPE;

CURSOR RES IS -- 1. 커서 선언 : 하나 이상의 row를 담을 객체
SELECT SAL, NVL(COMM,0) FROM EMP WHERE ENAME = V_ENAME;

BEGIN
OPEN RES; -- 2. 커서 시작
LOOP -- 한줄 이상 대입 변수 출력 , loop 구문 사용
FETCH RES INTO V_SAL, V_COMM; -- 3. 변수를 대입

EXIT WHEN RES%NOTFOUND;
DBMS_OUTPUT.PUT_LINE(V_ENAME ||'의 봉급은 '||V_SAL|| ' 커미션은 ' || V_COMM);
END LOOP;
CLOSE RES;
END EX_VIEW03;
/
~~~

~~~ sql
EXEC EX_VIEW03('KING') -- 실행
EXEC EX_VIEW03('MARTIN')  -- 실행
~~~


~~~ sql
-- PROCEDURE 방법2
CREATE OR REPLACE PROCEDURE EX_VIEW03(MYNAME IN EMP.ENAME%TYPE, MYRES OUT SYS_REFCURSOR)
IS
BEGIN
OPEN MYRES FOR
SELECT SAL, NVL(COMM,0) FROM EMP WHERE ENAME = MYNAME;
END EX_VIEW03;
/
~~~

~~~ sql
-- 실행
var myres refcursor;
EXEC EX_VIEW03('KING', :MYRES)

PRINT MYRES;
~~~

~~~ sql
-- FUNCTION 
CREATE OR REPLACE FUNCTION FN_VIEW03(MYNAME IN EMP.ENAME%TYPE)
RETURN SYS_REFCURSOR
IS
MYRES SYS_REFCURSOR;
BEGIN
OPEN MYRES FOR
SELECT SAL, NVL(COMM,0) FROM EMP WHERE ENAME = MYNAME;
RETURN MYRES;
END;
/
~~~

~~~ sql
VAR MYRES REFCURSOR;
EXEC :MYRES := FN_VIEW03('KING');

PRINT MYRES;
~~~

Q4. 사원의 부서번호와 부서이름, 직업을 리턴하자. EX_VIEW04
~~~ sql
-- PROCEDURE 방법1
CREATE OR REPLACE PROCEDURE EX_VIEW04
IS
V_EMPNO EMP.EMPNO%TYPE;
V_DEPTNO DEPT.DEPTNO%TYPE;
V_DNAME DEPT.DNAME%TYPE;
V_JOB EMP.JOB%TYPE;

CURSOR RES IS -- 1. 커서 선언 : 하나 이상의 row를 담을 객체
SELECT E.EMPNO, D.DEPTNO, D.DNAME, E.JOB 
FROM EMP E, DEPT D 
WHERE E.DEPTNO = D.DEPTNO;

BEGIN -- 실제 실행 코드
OPEN RES; -- 2. 커서 시작
LOOP -- 한줄 이상 대입 변수 출력 , loop 구문 사용
FETCH RES INTO V_EMPNO,V_DEPTNO,V_DNAME,V_JOB; -- 3. 변수를 대입

EXIT WHEN RES%NOTFOUND;
DBMS_OUTPUT.PUT_LINE(V_EMPNO||' '||V_DEPTNO|| ' '||V_DNAME|| ' '||V_JOB);
END LOOP;
CLOSE RES;
END EX_VIEW04;
/
~~~

~~~ sql
EXEC EX_VIEW04 -- 실행
~~~

~~~ sql
-- PROCEDURE 방법2
CREATE OR REPLACE PROCEDURE EX_VIEW04(MYRES OUT SYS_REFCURSOR)
IS
BEGIN
OPEN MYRES FOR
SELECT DEPTNO, DNAME, JOB FROM EMP JOIN DEPT USING(DEPTNO);
END EX_VIEW04;
/
~~~

~~~ sql
var M_RES refcursor;
EXEC EX_VIEW04(:M_RES)

PRINT M_RES
~~~

~~~ sql
-- FUNCTION 
CREATE OR REPLACE FUNCTION FN_VIEW04
RETURN SYS_REFCURSOR
IS
MYRES SYS_REFCURSOR;
BEGIN
OPEN MYRES FOR
SELECT DEPTNO, DNAME, JOB FROM EMP JOIN DEPT USING(DEPTNO);
RETURN MYRES;
END FN_VIEW04;
/
~~~

~~~ sql
VAR MYRES REFCURSOR;
EXEC :MYRES := FN_VIEW04();
EXEC :MYRES := FN_VIEW04; -- 둘다 가능

PRINT MYRES;
~~~


Q5. 사원의 번호를 입력 받아 부서 이름, 직업, 봉급을 리턴하자. EX_VIEW05
~~~ sql
-- PROCEDURE 방법1
CREATE OR REPLACE PROCEDURE EX_VIEW05(V_EMPNO IN EMP.EMPNO%TYPE)
IS
V_DNAME DEPT.DNAME%TYPE;
V_JOB EMP.JOB%TYPE;
V_SAL EMP.SAL%TYPE;

CURSOR RES IS -- 1. 커서 선언 : 하나 이상의 row를 담을 객체
SELECT D.DNAME, E.JOB, E.SAL 
FROM EMP E, DEPT D 
WHERE E.DEPTNO = D.DEPTNO AND E.EMPNO = V_EMPNO;

BEGIN
OPEN RES; -- 2. 커서 시작
LOOP -- 한줄 이상 대입 변수 출력 , loop 구문 사용
FETCH RES INTO V_DNAME, V_JOB, V_SAL; -- 3. 변수를 대입

EXIT WHEN RES%NOTFOUND;
DBMS_OUTPUT.PUT_LINE(V_EMPNO || ' ' || '부서 ' || V_DNAME || ' 직업 ' || V_JOB || '봉급은 ' || V_SAL);
END LOOP;
CLOSE RES;
END EX_VIEW05;
/

~~~ sql
EXEC EX_VIEW05(7902) -- 실행
~~~

~~~ sql
-- PROCEDURE 방법2
CREATE OR REPLACE PROCEDURE EX_VIEW05(MYNO IN EMP.EMPNO%TYPE, MYRES OUT SYS_REFCURSOR)
IS
BEGIN
OPEN MYRES FOR
SELECT DNAME, JOB, SAL FROM EMP JOIN DEPT USING(DEPTNO) WHERE EMPNO = MYNO;
END EX_VIEW05;
/
~~~

~~~ sql
var myres02 refcursor;
EXEC EX_VIEW05(7902, :myres02)

print myres02
~~~

~~~ sql
-- FUNCTION 
CREATE OR REPLACE FUNCTION FN_VIEW05(MYNO IN EMP.EMPNO%TYPE)
RETURN SYS_REFCURSOR
IS
MYRES SYS_REFCURSOR;
BEGIN
OPEN MYRES FOR
SELECT DNAME, JOB, SAL FROM EMP JOIN DEPT USING(DEPTNO) WHERE EMPNO = MYNO;
RETURN MYRES;
END;
/
~~~

~~~ sql
VAR MYRES REFCURSOR;
EXEC :MYRES := FN_VIEW05(7902);

PRINT MYRES;
~~~




























